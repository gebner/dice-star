/* 
  This file was generated by KreMLin <https://github.com/FStarLang/kremlin>
  KreMLin invocation: krml -no-prefix Minimal.DICE ./src/Minimal.DICE.fst -skip-compilation -tmpdir ./out -I ./src -I /home/zhetao/Sources/hacl-star/specs -I /home/zhetao/Sources/hacl-star/specs/lemmas -I /home/zhetao/Sources/hacl-star/code/hash -I /home/zhetao/Sources/hacl-star/code/hkdf -I /home/zhetao/Sources/hacl-star/code/hmac -I /home/zhetao/Sources/hacl-star/code/curve25519 -I /home/zhetao/Sources/hacl-star/code/ed25519 -I /home/zhetao/Sources/hacl-star/lib -I /home/zhetao/Sources/hacl-star/providers/evercrypt -warn-error +11
  F* version: 953b2211
  KreMLin version: e324b7e6
 */

#include "Minimal_DICE.h"

Spec_Hash_Definitions_hash_alg _DICE_ALG = Spec_Hash_Definitions_SHA2_256;

uint32_t _DICE_UDS_LENGTH = (uint32_t)0x20U;

uint32_t _DICE_DIGEST_LENGTH;

Lib_IntTypes_sec_int_t____ *uds;

Lib_IntTypes_sec_int_t____ *measurement;

Lib_IntTypes_sec_int_t____ *cdi;

static Prims_list__Lib_IntTypes_sec_int_t____
*FStar_Seq_Base_empty__Lib_IntTypes_sec_int_t___()
{
  KRML_CHECK_SIZE(sizeof (Prims_list__Lib_IntTypes_sec_int_t____), (uint32_t)1U);
  Prims_list__Lib_IntTypes_sec_int_t____
  *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Lib_IntTypes_sec_int_t____));
  buf[0U] = ((Prims_list__Lib_IntTypes_sec_int_t____){ .tag = Prims_Nil });
  return buf;
}

Prims_list__Lib_IntTypes_sec_int_t____
*FStar_Seq_Properties_seq_of_list__Lib_IntTypes_sec_int_t___(
  Prims_list__Lib_IntTypes_sec_int_t____ *l
)
{
  if (l->tag == Prims_Nil)
    return FStar_Seq_Base_empty__Lib_IntTypes_sec_int_t___();
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Lib_IntTypes_sec_int_t____ *tl1 = l->tl;
    Lib_IntTypes_sec_int_t____ hd1 = l->hd;
    return
      FStar_Seq_Base_op_At_Bar__Lib_IntTypes_sec_int_t___(FStar_Seq_Base_create__Lib_IntTypes_sec_int_t___((krml_checked_int_t)1,
          hd1),
        FStar_Seq_Properties_seq_of_list__Lib_IntTypes_sec_int_t___(tl1));
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Prims_list__Lib_IntTypes_sec_int_t____ *irrelContent;

void compute_measurement(uint32_t riot_size, Lib_IntTypes_sec_int_t____ *riot_binary)
{
  Hacl_Hash_SHA2_hash_256(riot_binary, riot_size, measurement);
}

void compute_cdi(uint32_t riot_size, Lib_IntTypes_sec_int_t____ *riot_binary)
{
  compute_measurement(riot_size, riot_binary);
  Hacl_HMAC_compute_sha2_256(cdi, uds, _DICE_UDS_LENGTH, measurement, _DICE_DIGEST_LENGTH);
}

void dice_main(uint32_t riot_size, Lib_IntTypes_sec_int_t____ *riot_binary)
{
  init_uds();
  compute_cdi(riot_size, riot_binary);
  clear_and_disabled_uds();
}

exit_code main()
{
  kremlinit_globals();
  dice_main(riot_size, riot_binary);
  return EXIT_SUCCESS;
}

