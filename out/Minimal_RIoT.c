/* 
  This file was generated by KreMLin <https://github.com/FStarLang/kremlin>
  KreMLin invocation: krml -no-prefix Minimal.Main ../src/Minimal.Main.fst -skip-compilation -tmpdir ../out -I /home/zhetao/Sources/hacl-star/specs -I /home/zhetao/Sources/hacl-star/specs/lemmas -I /home/zhetao/Sources/hacl-star/code/hash -I /home/zhetao/Sources/hacl-star/code/hkdf -I /home/zhetao/Sources/hacl-star/code/hmac -I /home/zhetao/Sources/hacl-star/code/curve25519 -I /home/zhetao/Sources/hacl-star/code/ed25519 -I /home/zhetao/Sources/hacl-star/lib -I /home/zhetao/Sources/hacl-star/providers/evercrypt -warn-error +11
  F* version: 953b2211
  KreMLin version: e324b7e6
 */

#include "Minimal_RIoT.h"

Spec_Hash_Definitions_hash_alg Minimal_RIoT__RIOT_ALG = Spec_Hash_Definitions_SHA2_256;

uint32_t Minimal_RIoT__RIOT_DIGEST_LENGTH;

uint32_t Minimal_RIoT__BIGLEN = (uint32_t)9U;

Lib_IntTypes_sec_int_t____
*Minimal_RIoT___proj__Mkbigval_t__item__bigval(Lib_IntTypes_sec_int_t____ *projectee)
{
  return projectee;
}

Lib_IntTypes_sec_int_t____
*Minimal_RIoT___proj__Mkaffine_point_t__item__x(Minimal_RIoT_affine_point_t projectee)
{
  return projectee.x;
}

Lib_IntTypes_sec_int_t____
*Minimal_RIoT___proj__Mkaffine_point_t__item__y(Minimal_RIoT_affine_point_t projectee)
{
  return projectee.y;
}

Lib_IntTypes_sec_int_t____
*Minimal_RIoT___proj__Mkaffine_point_t__item__infinity(Minimal_RIoT_affine_point_t projectee)
{
  return projectee.infinity;
}

Lib_IntTypes_sec_int_t____
*Minimal_RIoT___proj__Mkecdsa_sig_t__item__r(Minimal_RIoT_ecdsa_sig_t projectee)
{
  return projectee.r;
}

Lib_IntTypes_sec_int_t____
*Minimal_RIoT___proj__Mkecdsa_sig_t__item__s(Minimal_RIoT_ecdsa_sig_t projectee)
{
  return projectee.s;
}

void Minimal_RIoT_riotStart(uint32_t cdiLen, Lib_IntTypes_sec_int_t____ *cdi)
{
  Lib_IntTypes_sec_int_t____ *fwid = Minimal_RIoT_get_FWID();
  KRML_CHECK_SIZE(sizeof (Lib_IntTypes_sec_int_t____), Minimal_RIoT__RIOT_DIGEST_LENGTH);
  Lib_IntTypes_sec_int_t____ cDigest[Minimal_RIoT__RIOT_DIGEST_LENGTH];
  for (uint32_t _i = 0U; _i < Minimal_RIoT__RIOT_DIGEST_LENGTH; ++_i)
    cDigest[_i] = Lib_IntTypes_mk_int(Lib_IntTypes_U8, Lib_IntTypes_SEC, (krml_checked_int_t)0x00);
  KRML_CHECK_SIZE(sizeof (Lib_IntTypes_sec_int_t____), Minimal_RIoT__BIGLEN);
  Lib_IntTypes_sec_int_t____ uu____0[Minimal_RIoT__BIGLEN];
  for (uint32_t _i = 0U; _i < Minimal_RIoT__BIGLEN; ++_i)
    uu____0[_i]
    = Lib_IntTypes_mk_int(Lib_IntTypes_U32, Lib_IntTypes_SEC, (krml_checked_int_t)0x00);
  KRML_CHECK_SIZE(sizeof (Lib_IntTypes_sec_int_t____), Minimal_RIoT__BIGLEN);
  Lib_IntTypes_sec_int_t____ uu____1[Minimal_RIoT__BIGLEN];
  for (uint32_t _i = 0U; _i < Minimal_RIoT__BIGLEN; ++_i)
    uu____1[_i]
    = Lib_IntTypes_mk_int(Lib_IntTypes_U32, Lib_IntTypes_SEC, (krml_checked_int_t)0x00);
  Lib_IntTypes_sec_int_t____
  buf0 = Lib_IntTypes_mk_int(Lib_IntTypes_U32, Lib_IntTypes_SEC, (krml_checked_int_t)0x00);
  Minimal_RIoT_affine_point_t deviceIDPub = { .x = uu____0, .y = uu____1, .infinity = &buf0 };
  KRML_CHECK_SIZE(sizeof (Lib_IntTypes_sec_int_t____), Minimal_RIoT__BIGLEN);
  Lib_IntTypes_sec_int_t____ deviceIDPriv[Minimal_RIoT__BIGLEN];
  for (uint32_t _i = 0U; _i < Minimal_RIoT__BIGLEN; ++_i)
    deviceIDPriv[_i]
    = Lib_IntTypes_mk_int(Lib_IntTypes_U32, Lib_IntTypes_SEC, (krml_checked_int_t)0x00);
  KRML_CHECK_SIZE(sizeof (Lib_IntTypes_sec_int_t____), Minimal_RIoT__BIGLEN);
  Lib_IntTypes_sec_int_t____ uu____2[Minimal_RIoT__BIGLEN];
  for (uint32_t _i = 0U; _i < Minimal_RIoT__BIGLEN; ++_i)
    uu____2[_i]
    = Lib_IntTypes_mk_int(Lib_IntTypes_U32, Lib_IntTypes_SEC, (krml_checked_int_t)0x00);
  KRML_CHECK_SIZE(sizeof (Lib_IntTypes_sec_int_t____), Minimal_RIoT__BIGLEN);
  Lib_IntTypes_sec_int_t____ uu____3[Minimal_RIoT__BIGLEN];
  for (uint32_t _i = 0U; _i < Minimal_RIoT__BIGLEN; ++_i)
    uu____3[_i]
    = Lib_IntTypes_mk_int(Lib_IntTypes_U32, Lib_IntTypes_SEC, (krml_checked_int_t)0x00);
  Lib_IntTypes_sec_int_t____
  buf = Lib_IntTypes_mk_int(Lib_IntTypes_U32, Lib_IntTypes_SEC, (krml_checked_int_t)0x00);
  Minimal_RIoT_affine_point_t aliasKeyPub = { .x = uu____2, .y = uu____3, .infinity = &buf };
  KRML_CHECK_SIZE(sizeof (Lib_IntTypes_sec_int_t____), Minimal_RIoT__BIGLEN);
  Lib_IntTypes_sec_int_t____ aliasKeyPriv[Minimal_RIoT__BIGLEN];
  for (uint32_t _i = 0U; _i < Minimal_RIoT__BIGLEN; ++_i)
    aliasKeyPriv[_i]
    = Lib_IntTypes_mk_int(Lib_IntTypes_U32, Lib_IntTypes_SEC, (krml_checked_int_t)0x00);
  KRML_CHECK_SIZE(sizeof (Lib_IntTypes_sec_int_t____), Minimal_RIoT__BIGLEN);
  Lib_IntTypes_sec_int_t____ label_id[Minimal_RIoT__BIGLEN];
  for (uint32_t _i = 0U; _i < Minimal_RIoT__BIGLEN; ++_i)
    label_id[_i]
    = Lib_IntTypes_mk_int(Lib_IntTypes_U8, Lib_IntTypes_SEC, (krml_checked_int_t)0x00);
  KRML_CHECK_SIZE(sizeof (Lib_IntTypes_sec_int_t____), Minimal_RIoT__BIGLEN);
  Lib_IntTypes_sec_int_t____ label_alias[Minimal_RIoT__BIGLEN];
  for (uint32_t _i = 0U; _i < Minimal_RIoT__BIGLEN; ++_i)
    label_alias[_i]
    = Lib_IntTypes_mk_int(Lib_IntTypes_U8, Lib_IntTypes_SEC, (krml_checked_int_t)0x00);
  Minimal_RIoT_riotCrypt_Hash(Minimal_RIoT__RIOT_DIGEST_LENGTH, cDigest, cdiLen, cdi);
  Minimal_RIoT_riotCrypt_DeriveEccKey(deviceIDPub,
    deviceIDPriv,
    Minimal_RIoT__RIOT_ALG,
    cDigest,
    Minimal_RIoT__BIGLEN,
    label_id);
  Minimal_RIoT_riotCrypt_Hash2(Minimal_RIoT__RIOT_DIGEST_LENGTH,
    cDigest,
    Minimal_RIoT__RIOT_DIGEST_LENGTH,
    cDigest,
    Minimal_RIoT__RIOT_DIGEST_LENGTH,
    fwid);
  Minimal_RIoT_riotCrypt_DeriveEccKey(aliasKeyPub,
    aliasKeyPriv,
    Minimal_RIoT__RIOT_ALG,
    cDigest,
    Minimal_RIoT__BIGLEN,
    label_alias);
  Lib_IntTypes_sec_int_t____
  *aliasCert =
    Minimal_RIoT_signAliasCert(aliasKeyPub,
      deviceIDPub,
      Minimal_RIoT__RIOT_DIGEST_LENGTH,
      fwid,
      deviceIDPriv);
  Lib_IntTypes_sec_int_t____
  *deviceIDSelfCert =
    Minimal_RIoT_signDeviceCert(deviceIDPub,
      (
        (FStar_Pervasives_Native_option__Minimal_RIoT_affine_point_t){
          .tag = FStar_Pervasives_Native_None
        }
      ),
      deviceIDPriv);
}

