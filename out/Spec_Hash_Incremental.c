/* 
  This file was generated by KreMLin <https://github.com/FStarLang/kremlin>
  KreMLin invocation: krml -no-prefix Minimal.DICE ./src/Minimal.DICE.fst -skip-compilation -tmpdir ./out -I ./src -I /home/zhetao/Sources/hacl-star/specs -I /home/zhetao/Sources/hacl-star/specs/lemmas -I /home/zhetao/Sources/hacl-star/code/hash -I /home/zhetao/Sources/hacl-star/code/hkdf -I /home/zhetao/Sources/hacl-star/code/hmac -I /home/zhetao/Sources/hacl-star/code/curve25519 -I /home/zhetao/Sources/hacl-star/code/ed25519 -I /home/zhetao/Sources/hacl-star/lib -I /home/zhetao/Sources/hacl-star/providers/evercrypt -warn-error +11
  F* version: 953b2211
  KreMLin version: e324b7e6
 */

#include "Spec_Hash_Incremental.h"

static Prims_int
FStar_List_Tot_Base_length__Lib_IntTypes_sec_int_t___(
  Prims_list__Lib_IntTypes_sec_int_t____ *uu___4_154
)
{
  if (uu___4_154->tag == Prims_Nil)
    return (krml_checked_int_t)0;
  else if (uu___4_154->tag == Prims_Cons)
  {
    Prims_list__Lib_IntTypes_sec_int_t____ *tl1 = uu___4_154->tl;
    return
      Prims_op_Addition((krml_checked_int_t)1,
        FStar_List_Tot_Base_length__Lib_IntTypes_sec_int_t___(tl1));
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static Prims_int
FStar_Seq_Base_length__Lib_IntTypes_sec_int_t___(Prims_list__Lib_IntTypes_sec_int_t____ *s)
{
  return FStar_List_Tot_Base_length__Lib_IntTypes_sec_int_t___(s);
}

Prims_list__Lib_IntTypes_sec_int_t____
*Spec_Hash_Incremental_update_last(
  Spec_Hash_Definitions_hash_alg a,
  Prims_list__Lib_IntTypes_sec_int_t____ *hash1,
  Prims_int prevlen,
  Prims_list__Lib_IntTypes_sec_int_t____ *input
)
{
  Prims_int
  total_len = Prims_op_Addition(prevlen, FStar_Seq_Base_length__Lib_IntTypes_sec_int_t___(input));
  Prims_list__Lib_IntTypes_sec_int_t____ *padding = Spec_Hash_PadFinish_pad(a, total_len);
  return
    Spec_Agile_Hash_update_multi(a,
      hash1,
      FStar_Seq_Base_op_At_Bar__Lib_IntTypes_sec_int_t___(input, padding));
}

static K___FStar_Seq_Base_seq__Lib_IntTypes_sec_int_t_____FStar_Seq_Base_seq__Lib_IntTypes_sec_int_t____
FStar_Seq_Properties_split__Lib_IntTypes_sec_int_t___(
  Prims_list__Lib_IntTypes_sec_int_t____ *s,
  Prims_int i
)
{
  return
    (
      (K___FStar_Seq_Base_seq__Lib_IntTypes_sec_int_t_____FStar_Seq_Base_seq__Lib_IntTypes_sec_int_t____){
        .fst = FStar_Seq_Base_slice__Lib_IntTypes_sec_int_t___(s, (krml_checked_int_t)0, i),
        .snd = FStar_Seq_Base_slice__Lib_IntTypes_sec_int_t___(s,
          i,
          FStar_Seq_Base_length__Lib_IntTypes_sec_int_t___(s))
      }
    );
}

Prims_list__Lib_IntTypes_sec_int_t____
*Spec_Hash_Incremental_hash_incremental(
  Spec_Hash_Definitions_hash_alg a,
  Prims_list__Lib_IntTypes_sec_int_t____ *input
)
{
  Prims_int
  n1 =
    Prims_op_Division(FStar_Seq_Base_length__Lib_IntTypes_sec_int_t___(input),
      Spec_Hash_Definitions_block_length(a));
  K___FStar_Seq_Base_seq__Lib_IntTypes_sec_int_t_____FStar_Seq_Base_seq__Lib_IntTypes_sec_int_t____
  scrut =
    FStar_Seq_Properties_split__Lib_IntTypes_sec_int_t___(input,
      Prims_op_Multiply(n1, Spec_Hash_Definitions_block_length(a)));
  Prims_list__Lib_IntTypes_sec_int_t____ *bs = scrut.fst;
  Prims_list__Lib_IntTypes_sec_int_t____ *l = scrut.snd;
  Prims_list__Lib_IntTypes_sec_int_t____
  *hash1 = Spec_Agile_Hash_update_multi(a, Spec_Agile_Hash_init(a), bs);
  Prims_list__Lib_IntTypes_sec_int_t____
  *hash2 =
    Spec_Hash_Incremental_update_last(a,
      hash1,
      Prims_op_Multiply(n1, Spec_Hash_Definitions_block_length(a)),
      l);
  return Spec_Hash_PadFinish_finish(a, hash2);
}

